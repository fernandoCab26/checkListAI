#!/bin/sh
# ==========================
# Git Hook: commit-msg
# Validaci√≥n opcional con CheckCommit
# Se ejecuta SOLO si el mensaje contiene una palabra clave
# ==========================

# üîß Configura tus rutas aqu√≠
CHECKCOMMIT_EXE="D:/ChecklistCommit/program/Checklist.exe"
CHECKLIST_DIR="D:/ChecklistCommit"
REPORT_PATH="D:\ChecklistCommit\dotnet\checkcommit_report.md"

# Palabra clave que activa la validaci√≥n
KEYWORD="#checkList"

# Obtener el mensaje del commit
COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Verificar si contiene la palabra clave
echo "$COMMIT_MSG" | grep -qi "$KEYWORD"
if [ $? -eq 0 ]; then
    echo "üîç Validando checklist con Gemini..."
	# Cambiar dotnet o angular
    "$CHECKCOMMIT_EXE" dotnet D:/ChecklistCommit
    STATUS=$?

    if [ $STATUS -ne 0 ]; then
        echo "‚ùå Commit bloqueado: revisa el reporte en:"
        echo "üìÑ file:///$REPORT_PATH"
        # Abrir carpeta del reporte (Windows)
        explorer $REPORT_PATH
        exit 1
    fi

    echo "‚úÖ Validaci√≥n completada."
else
    echo "‚ö° Checklist omitido (no se encontr√≥ la palabra clave '$KEYWORD')."
fi

exit 0
